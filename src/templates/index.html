{% extends "layout.html" %}

{% block title %}
  References Management App
{% endblock %}

{% block body %}

  <h2 class="text-center my-4 text-success">References Management App</h2>
  <div class="table-container mb-4">
    <table class="table table-striped table-boarded">
      <thead>
        <tr>
          <th>Type</th>
          <th>Reference ID</th>
          <th>Author</th>
          <th>Title</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        {% for reference in references %}
          <tr>
            <td>{{ reference.reference_type }}</td>
            <td>{{ reference.reference_id }}</td>
            <td>{{ reference.author }}</td>
            <td>{{ reference.title }}</td>
            <td
              class="details"
              id="details_{{ reference.id }}"
              style="display:none;"
            >
              {% if reference.year %}Year: {{ reference.year }}<br />{% endif %}
              {% if reference.booktitle %}Booktitle: {{ reference.booktitle }}<br />{% endif %}
              {% if reference.editor %}Editor: {{ reference.editor }}<br />{% endif %}
              {% if reference.volume %}Volume: {{ reference.volume }}<br />{% endif %}
              {% if reference.number %}Number: {{ reference.number }}<br />{% endif %}
              {% if reference.series %}Series: {{ reference.series }}<br />{% endif %}
              {% if reference.pages %}Pages: {{ reference.pages }}<br />{% endif %}
              {% if reference.address %}Address: {{ reference.address }}<br />{% endif %}
              {% if reference.journal %}Journal: {{ reference.journal }}<br />{% endif %}
              {% if reference.month %}Month: {{ reference.month }}<br />{% endif %}
              {% if reference.note %}Note: {{ reference.note }}<br />{% endif %}
              {% if reference.organization %}Organization: {{ reference.organization }}<br />{% endif %}
              {% if reference.publisher %}Publisher: {{ reference.publisher }}<br />{% endif %}
            </td>
            <td>
              <button
                type="button"
                class="toggle-btn"
                name="show_more_button"
                data-ref-id="{{ reference.id }}"
              >
                Show more
              </button>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
    // Function to toggle the visibility of the details section for each reference
    document.querySelectorAll(".toggle-btn").forEach((button) => {
      button.addEventListener("click", () => {
        const refId = button.getAttribute("data-ref-id");
        const detailsSection = document.getElementById(`details_${refId}`);
        const isVisible = detailsSection.style.display === "block";

        // Toggle the visibility: show if hidden, hide if visible
        detailsSection.style.display = isVisible ? "none" : "block";
        // Change the button text based on visibility
        button.textContent = isVisible ? "Show more" : "Hide";
      });
    });
  </script>
  <div class="container-fluid mb-4">
    <a href="/new_reference" class="btn btn-success" id="button_to_reference">
      Create a new reference</a
    >
    <form action="/download" method="GET" style="display: block;">
      <br />
      <button type="submit" name="download"  class="btn btn-success">Download</button>
    </form>
    <br />
    <a href="/preview" class="btn btn-success" id="button_to_preview">Preview</a>
  </div>
  {% with messages = get_flashed_messages() %}{% if messages %}
    <ul>
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}{% endwith %}
{% endblock %}
